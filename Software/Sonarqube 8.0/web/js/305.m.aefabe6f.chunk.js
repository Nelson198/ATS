(window.webpackJsonp=window.webpackJsonp||[]).push([[305],{1070:function(e,t,n){"use strict";var a=n(324),s=n.n(a),r=n(2),i=n(310),c=n(314),o=n.n(c),l=n(5),d=n(309),u=n(493),p=n.n(u),h=n(691),m=n(741),g=n(742);function b(e){let t=e.event;return Object(g.b)(t)?r.createElement(g.a,{event:t}):Object(m.b)(t)?r.createElement(h.a.Consumer,null,e=>{let n=e.branchLike;return r.createElement(m.a,{branchLike:n,event:t})}):r.createElement("div",{className:"project-activity-event-inner"},r.createElement("div",{className:"project-activity-event-inner-main"},r.createElement(p.a,{className:d("project-activity-event-icon","little-spacer-right",t.category)}),r.createElement("span",{className:"project-activity-event-inner-text"},r.createElement("span",{className:"note little-spacer-right"},Object(l.translate)("event.category",t.category),":"),r.createElement("strong",{title:t.description},t.name))))}var v=n(341),y=n.n(v);class f extends r.PureComponent{constructor(e){super(e),this.changeInput=e=>{this.setState({name:e.target.value})},this.handleSubmit=()=>this.props.changeEvent(this.props.event.key,this.state.name),this.state={name:e.event.name}}render(){const e=this.state.name;return r.createElement(y.a,{confirmButtonText:Object(l.translate)("change_verb"),confirmDisable:!e||e===this.props.event.name,header:this.props.header,onClose:this.props.onClose,onConfirm:this.handleSubmit,size:"small"},r.createElement("div",{className:"modal-field"},r.createElement("label",null,Object(l.translate)("name")),r.createElement("input",{autoFocus:!0,onChange:this.changeInput,type:"text",value:e})))}}class S extends r.PureComponent{constructor(){super(...arguments),this.handleSubmit=()=>this.props.deleteEvent(this.props.analysis,this.props.event.key)}render(){return r.createElement(y.a,{confirmButtonText:Object(l.translate)("delete"),header:this.props.header,isDestructive:!0,onClose:this.props.onClose,onConfirm:this.handleSubmit},Object(l.translate)(this.props.removeEventQuestion))}}class E extends r.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={changing:!1,deleting:!1},this.startChanging=()=>{this.setState({changing:!0})},this.stopChanging=()=>{this.mounted&&this.setState({changing:!1})},this.startDeleting=()=>{this.setState({deleting:!0})},this.stopDeleting=()=>{this.mounted&&this.setState({deleting:!1})}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const e=this.props,t=e.event,n=e.canAdmin,a="OTHER"===t.category,s=!a&&"VERSION"===t.category,c=a||s,d=a||s&&!this.props.isFirst,u=n&&(c||d);return r.createElement("div",{className:"project-activity-event"},r.createElement(b,{event:this.props.event}),u&&r.createElement("div",{className:"project-activity-event-actions spacer-left"},c&&r.createElement(o.a,{overlay:Object(l.translate)("project_activity.events.tooltip.edit")},r.createElement(i.EditButton,{className:"js-change-event button-small",onClick:this.startChanging})),d&&r.createElement(o.a,{overlay:Object(l.translate)("project_activity.events.tooltip.delete")},r.createElement(i.DeleteButton,{className:"js-delete-event button-small",onClick:this.startDeleting}))),this.state.changing&&r.createElement(f,{changeEvent:this.props.changeEvent,event:this.props.event,header:s?Object(l.translate)("project_activity.change_version"):Object(l.translate)("project_activity.change_custom_event"),onClose:this.stopChanging}),this.state.deleting&&r.createElement(S,{analysis:this.props.analysis,deleteEvent:this.props.deleteEvent,event:this.props.event,header:s?Object(l.translate)("project_activity.remove_version"):Object(l.translate)("project_activity.remove_custom_event"),onClose:this.stopDeleting,removeEventQuestion:"project_activity.".concat(s?"remove_version":"remove_custom_event",".question")}))}}function j(e){const t=s()(e.events,e=>"VERSION"===e.category?1:0,"category");return r.createElement("div",{className:"project-activity-events"},t.map(t=>r.createElement(E,{analysis:e.analysis,canAdmin:e.canAdmin,changeEvent:e.changeEvent,deleteEvent:e.deleteEvent,event:t,isFirst:e.isFirst,key:t.key})))}n.d(t,"a",function(){return j})},1670:function(e,t,n){var a=n(1671);"string"==typeof a&&(a=[[e.i,a,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};n(313)(a,s);a.locals&&(e.exports=a.locals)},1671:function(e,t,n){(e.exports=n(312)(!1)).push([e.i,".project-baseline{padding:32px}.project-baseline-selector>.branch-baseline-setting-modal{max-height:60vh;padding-top:2px}.project-baseline-selector .general-setting{margin-left:7px}.branch-baseline-selector>hr{margin:0 -32px 32px}.branch-analysis-list-wrapper,.branch-baseline-setting-modal{display:flex;flex-direction:column}.branch-analysis-list-wrapper{overflow:hidden;position:relative;min-height:200px}.branch-analysis-list{overflow-y:auto;padding-left:12px;padding-right:15px;min-height:50px}.branch-analysis-list>ul{padding-top:18px}.branch-analysis-date{margin-bottom:16px;font-size:15px;font-weight:700}.branch-analysis-day{margin-top:8px;margin-bottom:24px}.branch-analysis{display:flex;justify-content:space-between;cursor:pointer;padding:8px;border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6}.branch-analysis+.branch-analysis{border-top:none}.branch-analysis:hover{background-color:#cae3f2}.branch-analysis>.project-activity-events{flex:1 0 50%}.branch-analysis-time{width:150px}.branch-analysis-version-badge{margin-left:-12px;padding-top:8px;padding-bottom:8px;background-color:#fff}.branch-analysis-version-badge.sticky+.branch-analysis-days-list{padding-top:36px}.branch-analysis-version-badge.first,.branch-analysis-version-badge.sticky{position:absolute;top:1px;left:13px;right:16px;padding-top:24px;z-index:1}.branch-analysis-version-badge .badge{max-width:385px;border-radius:0 2px 2px 0;font-weight:700;font-size:12px;letter-spacing:0;overflow:hidden;text-overflow:ellipsis}.project-activity-event-icon.VERSION{color:#4b9fd5}.project-activity-event-icon.QUALITY_GATE{color:#9139d4}.project-activity-event-icon.QUALITY_PROFILE{color:#ccc}.project-activity-event-icon.DEFINITION_CHANGE{color:#33a759}.project-activity-event-icon.OTHER{color:#442d1b}.invisible{visibility:hidden}",""])},1795:function(e,t,n){"use strict";n.r(t);var a=n(316),s=n(317),r=n(2),i=n(304),c=n(28),o=n(315),l=n.n(o),d=n(5),u=n(773),p=n(330),h=(n(1670),n(774)),m=n(372),g=n.n(m),b=n(596),v=n(344),y=n(331),f=n(310),S=n(327),E=n.n(S),j=n(29),O=n(426),_=n.n(O);function N(e){let t=e.disabled,n=e.onSelect,a=e.selected;return r.createElement(_.a,{disabled:t,onClick:()=>n("SPECIFIC_ANALYSIS"),selected:a,title:Object(d.translate)("baseline.specific_analysis")},r.createElement("p",{className:"big-spacer-bottom"},Object(d.translate)("baseline.specific_analysis.description")))}var C=n(820),k=n(821),x=n(518),A=n.n(x),D=n(309),I=n(961),P=n(338),w=n.n(P),R=n(314),F=n.n(R),L=n(439),V=n(739),B=n(342),T=n(577),M=n(1070),U=n(476);class Y extends r.PureComponent{constructor(e){super(e),this.mounted=!1,this.badges={},this.state={analyses:[],loading:!0,range:30,scroll:0},this.handleScroll=e=>{e.currentTarget&&this.updateScroll(e.currentTarget.scrollTop)},this.updateScroll=e=>{this.setState({scroll:e})},this.registerBadgeNode=e=>t=>{t&&(t.getAttribute("originOffsetTop")||t.setAttribute("originOffsetTop",String(t.offsetTop)),this.badges[e]=t)},this.shouldStick=e=>{const t=this.badges[e];return t&&Number(t.getAttribute("originOffsetTop"))<this.state.scroll+10},this.handleRangeChange=e=>{let t=e.value;this.setState({range:t},()=>this.fetchAnalyses())},this.rootNodeRef=r.createRef(),this.updateScroll=A()(this.updateScroll,20)}componentDidMount(){this.mounted=!0,this.fetchAnalyses(!0)}componentWillUnmount(){this.mounted=!1}scrollToSelected(){const e=document.querySelector(".branch-analysis.selected");this.rootNodeRef.current&&e&&Object(L.scrollToElement)(e,{parent:this.rootNodeRef.current,bottomOffset:40})}fetchAnalyses(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.props,n=t.analysis,a=t.branch,s=t.component,r=this.state.range;return this.setState({loading:!0}),Object(V.e)({branch:a,project:s,from:r?Object(j.toShortNotSoISOString)(Object(I.subDays)(new Date,r)):void 0}).then(t=>{e&&n&&!t.analyses.find(e=>e.key===n)?this.handleRangeChange({value:0}):this.setState({analyses:t.analyses.map(e=>Object.assign({},e,{date:Object(j.parseDate)(e.date)})),loading:!1},()=>{this.scrollToSelected()})})}getRangeOptions(){return[{label:Object(d.translate)("baseline.branch_analyses.ranges.30days"),value:30},{label:Object(d.translate)("baseline.branch_analyses.ranges.allTime"),value:0}]}render(){const e=this.state,t=e.analyses,n=e.loading,a=e.range,s=Object(U.k)(t,{category:"",customMetrics:[],graph:"",project:this.props.component}),i=s.length>1||1===s.length&&Object.keys(s[0].byDay).length>0;return r.createElement(r.Fragment,null,r.createElement("div",{className:"spacer-bottom"},Object(d.translate)("baseline.analysis_from"),r.createElement(w.a,{autoBlur:!0,className:"input-medium spacer-left",clearable:!1,onChange:this.handleRangeChange,options:this.getRangeOptions(),searchable:!1,value:a})),r.createElement("div",{className:"branch-analysis-list-wrapper"},r.createElement("div",{className:"bordered branch-analysis-list",onScroll:this.handleScroll,ref:this.rootNodeRef},n&&r.createElement(l.a,{className:"big-spacer-top"}),n||i?r.createElement("ul",null,s.map((e,n)=>{const a=Object.keys(e.byDay);return a.length<=0?null:r.createElement("li",{key:e.key||"noversion"},e.version&&r.createElement("div",{className:D("branch-analysis-version-badge",{first:0===n,sticky:this.shouldStick(e.version)}),ref:this.registerBadgeNode(e.version)},r.createElement(F.a,{mouseEnterDelay:.5,overlay:"".concat(Object(d.translate)("version")," ").concat(e.version)},r.createElement("span",{className:"badge"},e.version))),r.createElement("ul",{className:"branch-analysis-days-list"},a.map(n=>r.createElement("li",{className:"branch-analysis-day","data-day":Object(j.toShortNotSoISOString)(Number(n)),key:n},r.createElement("div",{className:"branch-analysis-date"},r.createElement(B.a,{date:Number(n),long:!0})),r.createElement("ul",{className:"branch-analysis-analyses-list"},null!=e.byDay[n]&&e.byDay[n].map(e=>r.createElement("li",{className:D("branch-analysis",{selected:e.key===this.props.analysis}),"data-date":Object(j.parseDate)(e.date).valueOf(),key:e.key,onClick:()=>this.props.onSelectAnalysis(e)},r.createElement("div",{className:"branch-analysis-time spacer-right"},r.createElement(T.a,{date:Object(j.parseDate)(e.date),long:!1},t=>r.createElement("time",{className:"text-middle",dateTime:Object(j.parseDate)(e.date).toISOString()},t))),e.events.length>0&&r.createElement(M.a,{analysis:e.key,changeEvent:()=>Promise.resolve(),deleteEvent:()=>Promise.resolve(),events:e.events,isFirst:t[0].key===e.key}),r.createElement("div",{className:"analysis-selection-button"},r.createElement("i",{className:D("icon-radio",{"is-checked":e.key===this.props.analysis})})))))))))})):r.createElement("div",{className:"big-spacer-top big-spacer-bottom strong"},Object(d.translate)("baseline.no_analyses")))))}}class G extends r.PureComponent{constructor(e){super(e),this.mounted=!1,this.handleSubmit=e=>{e.preventDefault();const t=this.props,n=t.branch,a=t.component,s=this.state,r=s.analysis,i=s.analysisDate,c=s.days,o=s.selected,l=Object(h.a)({type:o,analysis:r,days:c});o&&(this.setState({saving:!0}),Object(u.d)({project:a,type:o,value:l,branch:n.name}).then(()=>{this.setState({saving:!1}),this.props.onClose(n.name,{type:o,value:l,effectiveValue:i&&Object(j.toNotSoISOString)(i)})},()=>{this.setState({saving:!1})}))},this.requestClose=()=>this.props.onClose(),this.handleSelectAnalysis=e=>this.setState({analysis:e.key,analysisDate:e.date}),this.handleSelectDays=e=>this.setState({days:e}),this.handleSelectSetting=e=>this.setState({selected:e}),this.state={analysis:this.getValueFromProps("SPECIFIC_ANALYSIS")||"",days:this.getValueFromProps("NUMBER_OF_DAYS")||"30",saving:!1,selected:this.props.branch.newCodePeriod&&this.props.branch.newCodePeriod.type}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}getValueFromProps(e){return this.props.branch.newCodePeriod&&this.props.branch.newCodePeriod.type===e?this.props.branch.newCodePeriod.value:null}render(){const e=this.props.branch,t=this.state,n=t.analysis,a=t.days,s=t.saving,i=t.selected,c=Object(d.translateWithParameters)("baseline.new_code_period_for_branch_x",e.name),o=e.newCodePeriod&&e.newCodePeriod.type,u=e.newCodePeriod&&e.newCodePeriod.value,p=Object(h.c)({analysis:n,currentSetting:o,currentSettingValue:u,days:a,selected:i}),m=p.isChanged,g=p.isValid;return r.createElement(E.a,{contentLabel:c,onRequestClose:this.requestClose,size:"large"},r.createElement("header",{className:"modal-head"},r.createElement("h2",null,c)),r.createElement("form",{onSubmit:this.handleSubmit},r.createElement("div",{className:"modal-body modal-container branch-baseline-setting-modal"},r.createElement("div",{className:"display-flex-row huge-spacer-bottom",role:"radiogroup"},r.createElement(k.a,{isDefault:!1,onSelect:this.handleSelectSetting,selected:"PREVIOUS_VERSION"===i}),r.createElement(C.a,{days:a,isChanged:m,isValid:g,onChangeDays:this.handleSelectDays,onSelect:this.handleSelectSetting,selected:"NUMBER_OF_DAYS"===i}),r.createElement(N,{onSelect:this.handleSelectSetting,selected:"SPECIFIC_ANALYSIS"===i})),"SPECIFIC_ANALYSIS"===i&&r.createElement(Y,{analysis:n,branch:e.name,component:this.props.component,onSelectAnalysis:this.handleSelectAnalysis})),r.createElement("footer",{className:"modal-foot"},r.createElement(l.a,{className:"spacer-right",loading:s}),r.createElement(f.SubmitButton,{disabled:!m||s||!g},Object(d.translate)("save")),r.createElement(f.ResetButtonLink,{onClick:this.props.onClose},Object(d.translate)("cancel")))))}}class q extends r.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={branches:[],loading:!0},this.updateBranchNewCodePeriod=(e,t)=>{const n=this.state.branches,a=n.find(t=>t.name===e);return a&&(a.newCodePeriod=t),n.slice(0)},this.openEditModal=e=>{this.setState({editedBranch:e})},this.closeEditModal=(e,t)=>{e?this.setState({branches:this.updateBranchNewCodePeriod(e,t),editedBranch:void 0}):this.setState({editedBranch:void 0})}}componentDidMount(){this.mounted=!0,this.fetchBranches()}componentWillUnmount(){this.mounted=!1}sortAndFilterBranches(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(y.k)(e.filter(e=>Object(y.g)(e)||Object(y.f)(e)))}fetchBranches(){const e=this.props.component.key;this.setState({loading:!0});const t=this.sortAndFilterBranches(this.props.branchLikes);Object(u.b)({project:e}).then(e=>{const n=e.newCodePeriods?e.newCodePeriods.filter(e=>!e.inherited):[],a=t.map(e=>{const t=n.find(t=>t.branchKey===e.name);if(!t)return e;const a=t.type,s=void 0===a?"PREVIOUS_VERSION":a,r=t.value,i=t.effectiveValue;return Object.assign({},e,{newCodePeriod:{type:s,value:r,effectiveValue:i}})});this.setState({branches:a,loading:!1})},()=>{this.setState({loading:!1})})}resetToDefault(e){return Object(u.c)({project:this.props.component.key,branch:e}).then(()=>{this.setState({branches:this.updateBranchNewCodePeriod(e,void 0)})})}renderNewCodePeriodSetting(e){switch(e.type){case"SPECIFIC_ANALYSIS":return r.createElement(r.Fragment,null,"".concat(Object(d.translate)("baseline.specific_analysis"),": "),e.effectiveValue?r.createElement(v.a,{date:e.effectiveValue}):"?");case"NUMBER_OF_DAYS":return"".concat(Object(d.translate)("baseline.number_days"),": ").concat(e.value);case"PREVIOUS_VERSION":return Object(d.translate)("baseline.previous_version");default:return e.type}}render(){const e=this.state,t=e.branches,n=e.editedBranch,a=e.loading;return t.length<1?null:a?r.createElement(l.a,null):r.createElement(r.Fragment,null,r.createElement("table",{className:"data zebra"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,Object(d.translate)("branch_list.branch")),r.createElement("th",{className:"nowrap huge-spacer-right"},Object(d.translate)("branch_list.current_setting")),r.createElement("th",{className:"thin nowrap"},Object(d.translate)("branch_list.actions")))),r.createElement("tbody",null,t.map(e=>r.createElement("tr",{key:e.name},r.createElement("td",{className:"nowrap"},r.createElement(b.a,{branchLike:e,className:"little-spacer-right"}),e.name,e.isMain&&r.createElement("div",{className:"badge spacer-left"},Object(d.translate)("branches.main_branch"))),r.createElement("td",{className:"huge-spacer-right nowrap"},e.newCodePeriod?this.renderNewCodePeriodSetting(e.newCodePeriod):Object(d.translate)("branch_list.default_setting")),r.createElement("td",{className:"text-right"},r.createElement(g.a,null,r.createElement(m.ActionsDropdownItem,{onClick:()=>this.openEditModal(e)},Object(d.translate)("edit")),e.newCodePeriod&&r.createElement(m.ActionsDropdownItem,{onClick:()=>this.resetToDefault(e.name)},Object(d.translate)("reset_to_default")))))))),n&&r.createElement(G,{branch:n,component:this.props.component.key,onClose:this.closeEditModal}))}}var z=n(623),H=n.n(z);function Q(e){const t=e.analysis,n=e.branchesEnabled,a=e.component,s=e.currentSetting,i=e.currentSettingValue,c=e.days,o=e.generalSetting,u=e.saving,p=e.selected,m=e.overrideGeneralSetting,g=Object(h.c)({analysis:t,currentSetting:s,currentSettingValue:i,days:c,selected:p,overrideGeneralSetting:m}),b=g.isChanged,v=g.isValid;return r.createElement("form",{className:"project-baseline-selector",onSubmit:e.onSubmit},r.createElement("div",{className:"big-spacer-top spacer-bottom",role:"radiogroup"},r.createElement(H.a,{checked:!m,className:"big-spacer-bottom",onCheck:()=>e.onToggleSpecificSetting(!1),value:"general"},Object(d.translate)("project_baseline.general_setting")),r.createElement("div",{className:"big-spacer-left"},function(e){let t,n;return"NUMBER_OF_DAYS"===e.type?(t="".concat(Object(d.translate)("baseline.number_days")," (").concat(Object(d.translateWithParameters)("duration.days",e.value||"?"),")"),n=Object(d.translate)("baseline.number_days.description")):(t=Object(d.translate)("baseline.previous_version"),n=Object(d.translate)("baseline.previous_version.description")),r.createElement("div",{className:"general-setting"},r.createElement("strong",null,t),": ",n)}(o)),r.createElement(H.a,{checked:m,className:"huge-spacer-top",onCheck:()=>e.onToggleSpecificSetting(!0),value:"specific"},Object(d.translate)("project_baseline.specific_setting"))),r.createElement("div",{className:"big-spacer-left big-spacer-right branch-baseline-setting-modal"},r.createElement("div",{className:"display-flex-row big-spacer-bottom",role:"radiogroup"},r.createElement(k.a,{disabled:!m,onSelect:e.onSelectSetting,selected:m&&"PREVIOUS_VERSION"===p}),r.createElement(C.a,{days:c,disabled:!m,isChanged:b,isValid:v,onChangeDays:e.onSelectDays,onSelect:e.onSelectSetting,selected:m&&"NUMBER_OF_DAYS"===p}),!n&&r.createElement(N,{disabled:!m,onSelect:e.onSelectSetting,selected:m&&"SPECIFIC_ANALYSIS"===p})),"SPECIFIC_ANALYSIS"===p&&r.createElement(Y,{analysis:t||"",branch:"master",component:a,onSelectAnalysis:e.onSelectAnalysis})),r.createElement("div",{className:D("big-spacer-top",{invisible:!b})},r.createElement("p",{className:"spacer-bottom"},Object(d.translate)("baseline.next_analysis_notice")),r.createElement(l.a,{className:"spacer-right",loading:u}),r.createElement(f.SubmitButton,{disabled:u||!v||!b},Object(d.translate)("save")),r.createElement(f.ResetButtonLink,{className:"spacer-left",onClick:e.onCancel},Object(d.translate)("cancel"))))}function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],a=!0,s=!1,r=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){s=!0,r=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}const J={type:"PREVIOUS_VERSION"};t.default=Object(a.connect)(e=>({branchesEnabled:Object(s.getAppState)(e).branchesEnabled,canAdmin:Object(s.getAppState)(e).canAdmin}))(class extends r.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={days:"30",loading:!0,saving:!1},this.resetSetting=()=>{this.setState({saving:!0}),Object(u.c)({project:this.props.component.key}).then(()=>{this.setState({saving:!1,currentSetting:void 0,selected:void 0})},()=>{this.setState({saving:!1})})},this.handleSelectAnalysis=e=>this.setState({analysis:e.key}),this.handleSelectDays=e=>this.setState({days:e}),this.handleCancel=()=>this.setState(e=>{let t=e.generalSetting,n=void 0===t?J:t,a=e.currentSetting,s=e.currentSettingValue;return this.getUpdatedState({generalSetting:n,currentSetting:a,currentSettingValue:s})}),this.handleSelectSetting=e=>this.setState({selected:e}),this.handleToggleSpecificSetting=e=>this.setState({overrideGeneralSetting:e}),this.handleSubmit=e=>{e.preventDefault();const t=this.props.component,n=this.state,a=n.analysis,s=n.days,r=n.selected;if(!n.overrideGeneralSetting)return void this.resetSetting();const i=Object(h.a)({type:r,analysis:a,days:s});r&&(this.setState({saving:!0}),Object(u.d)({project:t.key,type:r,value:i}).then(()=>{this.setState({saving:!1,currentSetting:r,currentSettingValue:i||void 0})},()=>{this.setState({saving:!1})}))}}componentDidMount(){this.mounted=!0,this.fetchLeakPeriodSetting()}componentWillUnmount(){this.mounted=!1}getUpdatedState(e){const t=e.currentSetting,n=e.currentSettingValue,a=e.generalSetting,s=!t&&"NUMBER_OF_DAYS"===a.type&&a.value||"30";return{loading:!1,currentSetting:t,currentSettingValue:n,generalSetting:a,selected:t||a.type,overrideGeneralSetting:Boolean(t),days:"NUMBER_OF_DAYS"===t&&n||s,analysis:"SPECIFIC_ANALYSIS"===t&&n||""}}fetchLeakPeriodSetting(){this.setState({loading:!0}),Promise.all([Object(u.a)(),Object(u.a)({branch:this.props.branchesEnabled?void 0:"master",project:this.props.component.key})]).then(e=>{let t=W(e,2),n=t[0],a=t[1];if(this.mounted){n.type||(n=J);const e=a.value,t=a.inherited?void 0:a.type||"PREVIOUS_VERSION";this.setState(this.getUpdatedState({generalSetting:n,currentSetting:t,currentSettingValue:e}))}},()=>{this.setState({loading:!1})})}renderHeader(){return r.createElement("header",{className:"page-header"},r.createElement("h1",{className:"page-title"},Object(d.translate)("project_baseline.page")),r.createElement("p",{className:"page-description"},r.createElement(i.FormattedMessage,{defaultMessage:Object(d.translate)("project_baseline.page.description"),id:"project_baseline.page.description",values:{link:r.createElement(c.Link,{to:"/documentation/project-administration/new-code-period/"},Object(d.translate)("project_baseline.page.description.link"))}}),r.createElement("br",null),this.props.canAdmin&&r.createElement(i.FormattedMessage,{defaultMessage:Object(d.translate)("project_baseline.page.description2"),id:"project_baseline.page.description2",values:{link:r.createElement(c.Link,{to:"/admin/settings?category=new_code_period"},Object(d.translate)("project_baseline.page.description2.link"))}})))}render(){const e=this.props,t=e.branchLikes,n=e.branchesEnabled,a=e.component,s=this.state,i=s.analysis,c=s.currentSetting,o=s.days,u=s.generalSetting,h=s.loading,m=s.currentSettingValue,g=s.overrideGeneralSetting,b=s.saving,v=s.selected;return r.createElement(r.Fragment,null,r.createElement(p.a,{suggestions:"project_baseline"}),r.createElement("div",{className:"page page-limited"},this.renderHeader(),h?r.createElement(l.a,null):r.createElement("div",{className:"panel-white project-baseline"},n&&r.createElement("h2",null,Object(d.translate)("project_baseline.default_setting")),u&&void 0!==g&&r.createElement(Q,{analysis:i,branchesEnabled:n,component:a.key,currentSetting:c,currentSettingValue:m,days:o,generalSetting:u,onCancel:this.handleCancel,onSelectAnalysis:this.handleSelectAnalysis,onSelectDays:this.handleSelectDays,onSelectSetting:this.handleSelectSetting,onSubmit:this.handleSubmit,onToggleSpecificSetting:this.handleToggleSpecificSetting,overrideGeneralSetting:g,saving:b,selected:v}),u&&n&&r.createElement("div",{className:"huge-spacer-top branch-baseline-selector"},r.createElement("hr",null),r.createElement("h2",null,Object(d.translate)("project_baseline.configure_branches")),r.createElement(q,{branchLikes:t,component:a,inheritedSetting:c?{type:c,value:m}:u})))))}})},330:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var a=n(2),s=n(349);function r(e){let t=e.suggestions;return a.createElement(s.a.Consumer,null,e=>{let n=e.addSuggestions,s=e.removeSuggestions;return a.createElement(i,{addSuggestions:n,removeSuggestions:s,suggestions:t})})}class i extends a.PureComponent{componentDidMount(){this.props.addSuggestions(this.props.suggestions)}componentDidUpdate(e){e.suggestions!==this.props.suggestions&&(this.props.removeSuggestions(this.props.suggestions),this.props.addSuggestions(e.suggestions))}componentWillUnmount(){this.props.removeSuggestions(this.props.suggestions)}render(){return null}}},342:function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"a",function(){return o});var a=n(2),s=n(304),r=n(29);const i={year:"numeric",month:"short",day:"2-digit"},c={year:"numeric",month:"long",day:"numeric"};function o(e){let t=e.children,n=e.date,o=e.long;return a.createElement(s.FormattedDate,Object.assign({value:Object(r.parseDate)(n)},o?c:i),t)}},344:function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return c});var a=n(2),s=n(304),r=n(29);const i={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"};function c(e){let t=e.children,n=e.date;return a.createElement(s.FormattedDate,Object.assign({value:Object(r.parseDate)(n)},i),t)}},476:function(e,t,n){"use strict";n.d(t,"c",function(){return y}),n.d(t,"a",function(){return f}),n.d(t,"b",function(){return S}),n.d(t,"d",function(){return E}),n.d(t,"e",function(){return _}),n.d(t,"f",function(){return N}),n.d(t,"g",function(){return C}),n.d(t,"h",function(){return k}),n.d(t,"i",function(){return x}),n.d(t,"p",function(){return A}),n.d(t,"q",function(){return D}),n.d(t,"r",function(){return I}),n.d(t,"s",function(){return P}),n.d(t,"t",function(){return w}),n.d(t,"v",function(){return R}),n.d(t,"j",function(){return F}),n.d(t,"y",function(){return L}),n.d(t,"o",function(){return V}),n.d(t,"k",function(){return B}),n.d(t,"l",function(){return T}),n.d(t,"m",function(){return M}),n.d(t,"n",function(){return U}),n.d(t,"u",function(){return G}),n.d(t,"w",function(){return q}),n.d(t,"x",function(){return z});var a=n(324),s=n.n(a),r=n(610),i=n.n(r),c=n(395),o=n.n(c),l=n(643),d=n.n(l),u=n(736),p=n.n(u),h=n(412),m=n(29),g=n(5),b=n(410),v=n(30);const y=["VERSION","QUALITY_GATE","QUALITY_PROFILE","OTHER"],f=["QUALITY_GATE","DEFINITION_CHANGE","OTHER"],S="issues",E=["issues","coverage","duplications","custom"],j={issues:["bugs","code_smells","vulnerabilities"],coverage:["lines_to_cover","uncovered_lines"],duplications:["ncloc","duplicated_lines"]},O={issues:j.issues.concat(["reliability_rating","security_rating","sqale_rating"]),coverage:j.coverage.concat(["coverage"]),duplications:j.duplications.concat(["duplicated_lines_density"])},_="sonar_project_activity.graph",N="sonar_project_activity.graph.custom";function C(e,t){return e.category!==t.category||x(e,t)}function k(e,t){return!i()(e.customMetrics,t.customMetrics)}function x(e,t){return!i()(e.from,t.from)||!i()(e.to,t.to)}function A(e){return e.data.some(e=>Boolean(e.y||0===e.y))}function D(e){return e.some(e=>e.data&&e.data.length>1)}function I(e){return e.some(e=>e.data&&e.data.length>1&&A(e))}function P(e,t){return e.graph!==t.graph}function w(e){return"custom"===e}function R(e,t){return!i()(e.selectedDate,t.selectedDate)}function F(e,t,n,a){return a.length<=0||void 0===e?[]:s()(e.filter(e=>a.indexOf(e.metric)>=0).map(a=>{if("uncovered_lines"===a.metric&&!w(t))return function(e,t){const n=t.find(e=>"lines_to_cover"===e.metric);return{data:n?e.history.map((e,t)=>({x:e.date,y:Number(n.history[t].value)-Number(e.value)})):[],name:"covered_lines",translatedName:Object(g.translate)("project_activity.custom_metric.covered_lines"),type:"INT"}}(a,e);const s=function(e,t){return Array.isArray(t)?t.find(t=>t.key===e):t[e]}(a.metric,n);return{data:a.history.map(e=>({x:e.date,y:s&&"LEVEL"===s.type?e.value:Number(e.value)})),name:a.metric,translatedName:s?Object(g.getLocalizedMetricName)(s):a.metric,type:s?s.type:"INT"}}),e=>a.indexOf("covered_lines"===e.name?"uncovered_lines":e.name))}function L(e,t,n){return d()(o()(e,e=>e.type),e=>p()(e,n)).slice(0,t)}function V(e){return e.length>0?e[0].type:"INT"}function B(e,t){return e.reduce((e,n)=>{let a=e[e.length-1];const s=n.events.find(e=>"VERSION"===e.category);if(s){const t={version:s.name,key:s.key,byDay:{}};!a||Object.keys(a.byDay).length>0?e.push(t):e[e.length-1]=t,a=t}else a||(a={version:null,key:null,byDay:{}},e.push(a));const r=h(Object(m.parseDate)(n.date)).getTime().toString();let i=!0;if(t.category||t.from||t.to){const e=!t.from||n.date>=t.from,a=!t.to||n.date<=t.to,s=!t.category||null!=n.events.find(e=>e.category===t.category);i=e&&a&&s}return i&&(a.byDay[r]||(a.byDay[r]=[]),a.byDay[r].push(n)),e},[])}function T(e,t){return w(e)?t:j[e]}function M(e,t){return w(e)?t:O[e]}function U(e){const t=Object(v.get)(N,e);return{graph:Object(v.get)(_,e)||"issues",customGraphs:t?t.split(","):[]}}function Y(e){const t=Object(b.parseAsString)(e);return E.includes(t)?t:S}function G(e){return{category:Object(b.parseAsString)(e.category),customMetrics:Object(b.parseAsArray)(e.custom_metrics,b.parseAsString),from:Object(b.parseAsDate)(e.from),graph:Y(e.graph),project:Object(b.parseAsString)(e.id),to:Object(b.parseAsDate)(e.to),selectedDate:Object(b.parseAsDate)(e.selected_date)}}function q(e){return Object(b.cleanQuery)({category:Object(b.serializeString)(e.category),from:Object(b.serializeDate)(e.from),project:Object(b.serializeString)(e.project),to:Object(b.serializeDate)(e.to)})}function z(e){return Object(b.cleanQuery)({category:Object(b.serializeString)(e.category),custom_metrics:Object(b.serializeStringArray)(e.customMetrics),from:Object(b.serializeDate)(e.from),graph:(t=e.graph,t===S?void 0:t),id:Object(b.serializeString)(e.project),to:Object(b.serializeDate)(e.to),selected_date:Object(b.serializeDate)(e.selectedDate)});var t}},577:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var a=n(2),s=n(304),r=n(29);const i={hour:"numeric",minute:"numeric"},c={hour:"numeric",minute:"numeric",second:"numeric"};function o(e){let t=e.children,n=e.date,o=e.long;return a.createElement(s.FormattedTime,Object.assign({value:Object(r.parseDate)(n)},o?c:i),t)}},596:function(e,t,n){"use strict";n.d(t,"a",function(){return p});var a=n(2),s=n(405),r=n.n(s),i=n(553),c=n.n(i),o=n(570),l=n.n(o),d=n(331),u=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&(n[a[s]]=e[a[s]])}return n};function p(e){var t=e.branchLike,n=u(e,["branchLike"]);return Object(d.h)(t)?a.createElement(c.a,Object.assign({},n)):Object(d.j)(t)?a.createElement(l.a,Object.assign({},n)):a.createElement(r.a,Object.assign({},n))}},691:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var a=n(2);const s=a.createContext({branchLike:void 0,component:void 0})},739:function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"b",function(){return i}),n.d(t,"d",function(){return c}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return l});var a=n(8),s=n(320);function r(e){return Object(a.getJSON)("/api/project_analyses/search",e).catch(s.a)}function i(e,t,n,r){const i={analysis:e,name:t};return n&&(i.category=n),r&&(i.description=r),Object(a.postJSON)("/api/project_analyses/create_event",i).then(e=>e.event,s.a)}function c(e){return Object(a.post)("/api/project_analyses/delete_event",{event:e}).catch(s.a)}function o(e,t,n){const r={event:e};return t&&(r.name=t),n&&(r.description=n),Object(a.postJSON)("/api/project_analyses/update_event",r).then(e=>e.event,s.a)}function l(e){return Object(a.post)("/api/project_analyses/delete",{analysis:e}).catch(s.a)}},741:function(e,t,n){"use strict";n.d(t,"b",function(){return y}),n.d(t,"a",function(){return f});var a=n(309),s=n(2),r=n(304),i=n(28),c=n(310),o=n(333),l=n.n(o),d=n(405),u=n.n(d),p=n(493),h=n.n(p),m=n(5),g=n(400),b=n(331),v=n(319);function y(e){return"DEFINITION_CHANGE"===e.category&&void 0!==e.definitionChange}class f extends s.PureComponent{constructor(){super(...arguments),this.state={expanded:!1},this.stopPropagation=e=>{e.stopPropagation()},this.toggleProjectsList=()=>{this.setState(e=>({expanded:!e.expanded}))},this.renderProjectLink=(e,t)=>s.createElement(i.Link,{onClick:this.stopPropagation,title:e.name,to:Object(v.s)(e.key,t)},Object(g.limitComponentName)(e.name,28)),this.renderBranch=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(m.translate)("branches.main_branch");return s.createElement("span",{className:"nowrap",title:e},s.createElement(u.a,{className:"little-spacer-left text-text-top"}),e)}}renderProjectChange(e){const t=!this.props.branchLike||Object(b.g)(this.props.branchLike);if("ADDED"===e.changeType){const n=t?"event.definition_change.added":"event.definition_change.branch_added";return s.createElement("div",{className:"text-ellipsis"},s.createElement(r.FormattedMessage,{defaultMessage:Object(m.translate)(n),id:n,values:{project:this.renderProjectLink(e,e.branch),branch:this.renderBranch(e.branch)}}))}if("REMOVED"===e.changeType){const n=t?"event.definition_change.removed":"event.definition_change.branch_removed";return s.createElement("div",{className:"text-ellipsis"},s.createElement(r.FormattedMessage,{defaultMessage:Object(m.translate)(n),id:n,values:{project:this.renderProjectLink(e,e.branch),branch:this.renderBranch(e.branch)}}))}return"BRANCH_CHANGED"===e.changeType?s.createElement(r.FormattedMessage,{defaultMessage:Object(m.translate)("event.definition_change.branch_replaced"),id:"event.definition_change.branch_replaced",values:{project:this.renderProjectLink(e,e.newBranch),oldBranch:this.renderBranch(e.oldBranch),newBranch:this.renderBranch(e.newBranch)}}):null}render(){const e=this.props.event,t=this.state.expanded;return s.createElement("div",{className:"project-activity-event-inner"},s.createElement("div",{className:"project-activity-event-inner-main"},s.createElement(h.a,{className:a("project-activity-event-icon","little-spacer-right",e.category)}),s.createElement("div",{className:"project-activity-event-inner-text flex-1"},s.createElement("span",{className:"note little-spacer-right"},Object(m.translate)("event.category",e.category))),s.createElement(c.ResetButtonLink,{className:"project-activity-event-inner-more-link",onClick:this.toggleProjectsList,stopPropagation:!0},t?Object(m.translate)("hide"):Object(m.translate)("more"),s.createElement(l.a,{className:"little-spacer-left",turned:t}))),t&&s.createElement("ul",{className:"project-activity-event-inner-more-content"},e.definitionChange.projects.map(e=>s.createElement("li",{className:"display-flex-center little-spacer-top",key:e.key},this.renderProjectChange(e)))))}}},742:function(e,t,n){"use strict";n.d(t,"b",function(){return b}),n.d(t,"a",function(){return v});var a=n(309),s=n(2),r=n(304),i=n(28),c=n(310),o=n(333),l=n.n(o),d=n(493),u=n.n(d),p=n(365),h=n.n(p),m=n(5),g=n(319);function b(e){return"QUALITY_GATE"===e.category&&void 0!==e.qualityGate}class v extends s.PureComponent{constructor(){super(...arguments),this.state={expanded:!1},this.stopPropagation=e=>{e.stopPropagation()},this.toggleProjectsList=()=>{this.setState(e=>({expanded:!e.expanded}))}}render(){const e=this.props.event,t=this.state.expanded;return s.createElement("div",{className:"project-activity-event-inner"},s.createElement("div",{className:"project-activity-event-inner-main"},s.createElement(u.a,{className:a("project-activity-event-icon","little-spacer-right",e.category)}),s.createElement("div",{className:"project-activity-event-inner-text flex-1"},s.createElement("span",{className:"note little-spacer-right"},Object(m.translate)("event.category",e.category),":"),e.qualityGate.stillFailing?s.createElement(r.FormattedMessage,{defaultMessage:Object(m.translate)("event.quality_gate.still_x"),id:"event.quality_gate.still_x",values:{status:s.createElement(h.a,{level:e.qualityGate.status,small:!0})}}):s.createElement(h.a,{level:e.qualityGate.status,small:!0})),e.qualityGate.failing.length>0&&s.createElement(c.ResetButtonLink,{className:"project-activity-event-inner-more-link",onClick:this.toggleProjectsList,stopPropagation:!0},t?Object(m.translate)("hide"):Object(m.translate)("more"),s.createElement(l.a,{className:"little-spacer-left",turned:t}))),t&&s.createElement("ul",{className:"project-activity-event-inner-more-content"},e.qualityGate.failing.map(t=>s.createElement("li",{className:"display-flex-center little-spacer-top",key:t.key},s.createElement(h.a,{className:"little-spacer-right",level:e.qualityGate.status,small:!0}),s.createElement("div",{className:"flex-1 text-ellipsis"},s.createElement(i.Link,{onClick:this.stopPropagation,title:t.name,to:Object(g.s)(t.key,t.branch)},t.name))))))}}},773:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"d",function(){return i}),n.d(t,"c",function(){return c}),n.d(t,"b",function(){return o});var a=n(8),s=n(320);function r(e){return Object(a.getJSON)("/api/new_code_periods/show",e).catch(s.a)}function i(e){return Object(a.post)("/api/new_code_periods/set",e).catch(s.a)}function c(e){return Object(a.post)("/api/new_code_periods/unset",e).catch(s.a)}function o(e){return Object(a.getJSON)("/api/new_code_periods/list",e).catch(s.a)}},774:function(e,t,n){"use strict";function a(e){const t=parseInt(e,10);return!(e.length<1||isNaN(t)||t<1||String(t)!==e)}function s(e){let t=e.analysis,n=e.days;switch(e.type){case"NUMBER_OF_DAYS":return n;case"SPECIFIC_ANALYSIS":return t;default:return}}function r(e){const t=e.analysis,n=void 0===t?"":t,s=e.currentSetting,r=e.currentSettingValue,i=e.days,c=e.selected,o=e.overrideGeneralSetting;let l;return{isChanged:l=s||void 0===o?!1===o||c!==s||"NUMBER_OF_DAYS"===c&&i!==r||"SPECIFIC_ANALYSIS"===c&&n!==r:o,isValid:!1===o||"PREVIOUS_VERSION"===c||"SPECIFIC_ANALYSIS"===c&&n.length>0||"NUMBER_OF_DAYS"===c&&a(i)}}n.d(t,"b",function(){return a}),n.d(t,"a",function(){return s}),n.d(t,"c",function(){return r})},820:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var a=n(2),s=n(426),r=n.n(s),i=n(567),c=n.n(i),o=n(5);function l(e){const t=e.className,n=e.days,s=e.disabled,i=e.isChanged,l=e.isValid,d=e.onChangeDays,u=e.onSelect,p=e.selected;return a.createElement(r.a,{className:t,disabled:s,onClick:()=>u("NUMBER_OF_DAYS"),selected:p,title:Object(o.translate)("baseline.number_days")},a.createElement(a.Fragment,null,a.createElement("p",{className:"big-spacer-bottom"},Object(o.translate)("baseline.number_days.description")),p&&a.createElement(c.a,{error:void 0,id:"baseline_number_of_days",isInvalid:i&&!l,isValid:i&&l,label:Object(o.translate)("baseline.specify_days"),required:!0},a.createElement("input",{onChange:e=>d(e.currentTarget.value),type:"text",value:n}))))}},821:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var a=n(2),s=n(426),r=n.n(s),i=n(5);function c(e){const t=e.disabled,n=e.isDefault,s=e.onSelect,c=e.selected;return a.createElement(r.a,{disabled:t,onClick:()=>s("PREVIOUS_VERSION"),selected:c,title:Object(i.translate)("baseline.previous_version")+(n?" (".concat(Object(i.translate)("default"),")"):"")},a.createElement("p",null,Object(i.translate)("baseline.previous_version.description")))}}}]);
//# sourceMappingURL=305.m.aefabe6f.chunk.js.map