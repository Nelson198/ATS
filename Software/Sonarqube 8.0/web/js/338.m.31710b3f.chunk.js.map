{"version":3,"sources":["webpack:///./src/main/js/apps/maintenance/components/MaintenanceAppContainer.tsx","webpack:///./src/main/js/components/intl/DateFromNow.tsx","webpack:///./src/main/js/api/system.ts","webpack:///./src/main/js/components/intl/TimeFormatter.tsx","webpack:///./src/main/js/apps/maintenance/components/App.tsx","webpack:///./src/main/js/apps/maintenance/styles.css?fea4","webpack:///./src/main/js/apps/maintenance/styles.css"],"names":["__webpack_require__","r","__webpack_exports__","d","MaintenanceAppContainer","react__WEBPACK_IMPORTED_MODULE_0__","_App__WEBPACK_IMPORTED_MODULE_1__","props","Object","assign","setup","DateFromNow","react_intl__WEBPACK_IMPORTED_MODULE_1__","sonar_ui_common_helpers_dates__WEBPACK_IMPORTED_MODULE_2__","_ref","children","date","value","setLogLevel","getSystemInfo","getSystemStatus","getSystemUpgrades","getMigrationStatus","migrateDatabase","restart","waitSystemUPStatus","sonar_ui_common_helpers_request__WEBPACK_IMPORTED_MODULE_0__","_app_utils_throwGlobalError__WEBPACK_IMPORTED_MODULE_1__","level","catch","max","slowThreshold","status","TimeFormatter","formatterOption","hour","minute","longFormatterOption","second","long","App","classnames__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_1__","react_helmet__WEBPACK_IMPORTED_MODULE_2__","react_helmet__WEBPACK_IMPORTED_MODULE_2___default","n","react_intl__WEBPACK_IMPORTED_MODULE_3__","sonar_ui_common_components_controls_buttons__WEBPACK_IMPORTED_MODULE_4__","sonar_ui_common_helpers_l10n__WEBPACK_IMPORTED_MODULE_5__","sonar_ui_common_helpers_urls__WEBPACK_IMPORTED_MODULE_6__","_api_system__WEBPACK_IMPORTED_MODULE_7__","_components_common_InstanceMessage__WEBPACK_IMPORTED_MODULE_8__","_components_intl_DateFromNow__WEBPACK_IMPORTED_MODULE_9__","_components_intl_TimeFormatter__WEBPACK_IMPORTED_MODULE_10__","_helpers_system__WEBPACK_IMPORTED_MODULE_11__","[object Object]","this","mounted","state","fetchStatus","fetchMigrationState","fetchSystemStatus","setState","message","undefined","startedAt","then","wasStarting","scheduleRefresh","loadPreviousPage","_ref2","interval","window","setTimeout","setInterval","location","href","handleMigrateClick","_ref3","clearInterval","_this$state","a","defaultTitle","className","id","panel-warning","defaultMessage","values","link","onClick","content","module","i","options","hmr","transform","insertInto","locals","exports","push"],"mappings":"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","file":"js/338.m.31710b3f.chunk.js","sourcesContent":["/*\n * SonarQube\n * Copyright (C) 2009-2019 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport App from './App';\n\ninterface Props {\n  location: { query: { return_to: string } };\n}\n\nexport default function MaintenanceAppContainer(props: Props) {\n  return <App setup={false} {...props} />;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2019 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { DateSource, FormattedRelative } from 'react-intl';\nimport { parseDate } from 'sonar-ui-common/helpers/dates';\n\ninterface Props {\n  children?: (formattedDate: string) => React.ReactNode;\n  date: DateSource;\n}\n\nexport default function DateFromNow({ children, date }: Props) {\n  return <FormattedRelative value={parseDate(date)}>{children}</FormattedRelative>;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2019 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { getJSON, post, postJSON, requestTryAndRepeatUntil } from 'sonar-ui-common/helpers/request';\nimport throwGlobalError from '../app/utils/throwGlobalError';\n\nexport function setLogLevel(level: string): Promise<void | Response> {\n  return post('/api/system/change_log_level', { level }).catch(throwGlobalError);\n}\n\nexport function getSystemInfo(): Promise<T.SysInfoCluster | T.SysInfoStandalone> {\n  return getJSON('/api/system/info').catch(throwGlobalError);\n}\n\nexport function getSystemStatus(): Promise<{ id: string; version: string; status: T.SysStatus }> {\n  return getJSON('/api/system/status');\n}\n\nexport function getSystemUpgrades(): Promise<{\n  upgrades: T.SystemUpgrade[];\n  updateCenterRefresh: string;\n}> {\n  return getJSON('/api/system/upgrades');\n}\n\nexport function getMigrationStatus(): Promise<{\n  message?: string;\n  startedAt?: string;\n  state: string;\n}> {\n  return getJSON('/api/system/db_migration_status');\n}\n\nexport function migrateDatabase(): Promise<{\n  message?: string;\n  startedAt?: string;\n  state: string;\n}> {\n  return postJSON('/api/system/migrate_db');\n}\n\nexport function restart(): Promise<void | Response> {\n  return post('/api/system/restart').catch(throwGlobalError);\n}\n\nexport function waitSystemUPStatus(): Promise<{\n  id: string;\n  version: string;\n  status: T.SysStatus;\n}> {\n  return requestTryAndRepeatUntil(\n    getSystemStatus,\n    { max: -1, slowThreshold: -15 },\n    ({ status }) => status === 'UP'\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2019 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { DateSource, FormattedTime } from 'react-intl';\nimport { parseDate } from 'sonar-ui-common/helpers/dates';\n\ninterface Props {\n  children?: (formattedDate: string) => React.ReactNode;\n  date: DateSource;\n  long?: boolean;\n}\n\nexport const formatterOption = { hour: 'numeric', minute: 'numeric' };\n\nexport const longFormatterOption = { hour: 'numeric', minute: 'numeric', second: 'numeric' };\n\nexport default function TimeFormatter({ children, date, long }: Props) {\n  return (\n    <FormattedTime value={parseDate(date)} {...(long ? longFormatterOption : formatterOption)}>\n      {children}\n    </FormattedTime>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2019 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport Helmet from 'react-helmet';\nimport { FormattedMessage } from 'react-intl';\nimport { Button } from 'sonar-ui-common/components/controls/buttons';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getBaseUrl, getReturnUrl } from 'sonar-ui-common/helpers/urls';\nimport { getMigrationStatus, getSystemStatus, migrateDatabase } from '../../../api/system';\nimport InstanceMessage from '../../../components/common/InstanceMessage';\nimport DateFromNow from '../../../components/intl/DateFromNow';\nimport TimeFormatter from '../../../components/intl/TimeFormatter';\nimport { isSonarCloud } from '../../../helpers/system';\nimport '../styles.css';\n\ninterface Props {\n  location: { query: { return_to?: string } };\n  setup: boolean;\n}\n\ninterface State {\n  message?: string;\n  startedAt?: string;\n  state?: string;\n  status?: string;\n  wasStarting?: boolean;\n}\n\nexport default class App extends React.PureComponent<Props, State> {\n  interval?: number;\n  mounted = false;\n  state: State = {};\n\n  componentDidMount() {\n    this.mounted = true;\n    this.fetchStatus();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    if (this.interval) {\n      window.clearInterval(this.interval);\n    }\n  }\n\n  fetchStatus = () => {\n    const request = this.props.setup ? this.fetchMigrationState() : this.fetchSystemStatus();\n    request.catch(() => {\n      if (this.mounted) {\n        this.setState({\n          message: undefined,\n          startedAt: undefined,\n          state: undefined,\n          status: 'OFFLINE'\n        });\n      }\n    });\n  };\n\n  fetchSystemStatus = () => {\n    return getSystemStatus().then(({ status }) => {\n      if (this.mounted) {\n        this.setState({ status });\n\n        if (status === 'STARTING') {\n          this.setState({ wasStarting: true });\n          this.scheduleRefresh();\n        } else if (status === 'UP') {\n          if (this.state.wasStarting) {\n            this.loadPreviousPage();\n          }\n        } else {\n          this.scheduleRefresh();\n        }\n      }\n    });\n  };\n\n  fetchMigrationState = () => {\n    return getMigrationStatus().then(({ message, startedAt, state }) => {\n      if (this.mounted) {\n        this.setState({ message, startedAt, state });\n        if (state === 'MIGRATION_SUCCEEDED') {\n          this.loadPreviousPage();\n        } else if (state !== 'NO_MIGRATION') {\n          this.scheduleRefresh();\n        }\n      }\n    });\n  };\n\n  scheduleRefresh = () => {\n    this.interval = window.setTimeout(this.fetchStatus, 5000);\n  };\n\n  loadPreviousPage = () => {\n    setInterval(() => {\n      window.location.href = getReturnUrl(this.props.location);\n    }, 2500);\n  };\n\n  handleMigrateClick = () => {\n    migrateDatabase().then(\n      ({ message, startedAt, state }) => {\n        if (this.mounted) {\n          this.setState({ message, startedAt, state });\n        }\n      },\n      () => {}\n    );\n  };\n\n  render() {\n    const { state, status } = this.state;\n\n    return (\n      <>\n        <Helmet defaultTitle={translate('maintenance.page')} />\n        <div className=\"page-wrapper-simple\" id=\"bd\">\n          <div\n            className={classNames('page-simple', {\n              'panel-warning': state === 'MIGRATION_REQUIRED'\n            })}\n            id=\"nonav\">\n            {status === 'OFFLINE' && (\n              <>\n                <h1 className=\"maintenance-title text-danger\">\n                  <InstanceMessage message={translate('maintenance.is_offline')} />\n                </h1>\n                {!isSonarCloud() && (\n                  <p className=\"maintenance-text\">\n                    {translate('maintenance.sonarqube_is_offline.text')}\n                  </p>\n                )}\n                <p className=\"maintenance-text text-center\">\n                  <a href={getBaseUrl() + '/'}>{translate('maintenance.try_again')}</a>\n                </p>\n              </>\n            )}\n\n            {status === 'UP' && (\n              <>\n                <h1 className=\"maintenance-title\">\n                  <InstanceMessage message={translate('maintenance.is_up')} />\n                </h1>\n                <p className=\"maintenance-text text-center\">\n                  {translate('maintenance.all_systems_opetational')}\n                </p>\n                <p className=\"maintenance-text text-center\">\n                  <a href={getBaseUrl() + '/'}>{translate('layout.home')}</a>\n                </p>\n              </>\n            )}\n\n            {status === 'STARTING' && (\n              <>\n                <h1 className=\"maintenance-title\">\n                  <InstanceMessage message={translate('maintenance.is_starting')} />\n                </h1>\n                <p className=\"maintenance-spinner\">\n                  <i className=\"spinner\" />\n                </p>\n              </>\n            )}\n\n            {status === 'DOWN' && (\n              <>\n                <h1 className=\"maintenance-title text-danger\">\n                  <InstanceMessage message={translate('maintenance.is_down')} />\n                </h1>\n                <p className=\"maintenance-text\">\n                  {translate('maintenance.sonarqube_is_down.text')}\n                </p>\n                <p className=\"maintenance-text text-center\">\n                  <a href={getBaseUrl() + '/'}>{translate('maintenance.try_again')}</a>\n                </p>\n              </>\n            )}\n\n            {(status === 'DB_MIGRATION_NEEDED' || status === 'DB_MIGRATION_RUNNING') && (\n              <>\n                <h1 className=\"maintenance-title\">\n                  <InstanceMessage message={translate('maintenance.is_under_maintenance')} />\n                </h1>\n                {!isSonarCloud() && (\n                  <>\n                    <p className=\"maintenance-text\">\n                      <FormattedMessage\n                        defaultMessage={translate('maintenance.sonarqube_is_under_maintenance.1')}\n                        id=\"maintenance.sonarqube_is_under_maintenance.1\"\n                        values={{\n                          link: (\n                            <a href=\"https://redirect.sonarsource.com/doc/plugin-library.html\">\n                              {translate('maintenance.sonarqube_is_under_maintenance_link.1')}\n                            </a>\n                          )\n                        }}\n                      />\n                    </p>\n                    <p className=\"maintenance-text\">\n                      <FormattedMessage\n                        defaultMessage={translate('maintenance.sonarqube_is_under_maintenance.2')}\n                        id=\"maintenance.sonarqube_is_under_maintenance.2\"\n                        values={{\n                          link: (\n                            <a href=\"https://redirect.sonarsource.com/doc/upgrading.html\">\n                              {translate('maintenance.sonarqube_is_under_maintenance_link.2')}\n                            </a>\n                          )\n                        }}\n                      />\n                    </p>\n                  </>\n                )}\n              </>\n            )}\n\n            {state === 'NO_MIGRATION' && (\n              <>\n                <h1 className=\"maintenance-title\">\n                  {translate('maintenance.database_is_up_to_date')}\n                </h1>\n                <p className=\"maintenance-text text-center\">\n                  <a href={getBaseUrl() + '/'}>{translate('layout.home')}</a>\n                </p>\n              </>\n            )}\n\n            {state === 'MIGRATION_REQUIRED' && (\n              <>\n                <h1 className=\"maintenance-title\">{translate('maintenance.upgrade_database')}</h1>\n                <p className=\"maintenance-text\">{translate('maintenance.upgrade_database.1')}</p>\n                <p className=\"maintenance-text\">{translate('maintenance.upgrade_database.2')}</p>\n                <p className=\"maintenance-text\">{translate('maintenance.upgrade_database.3')}</p>\n                <div className=\"maintenance-spinner\">\n                  <Button id=\"start-migration\" onClick={this.handleMigrateClick}>\n                    {translate('maintenance.upgrade')}\n                  </Button>\n                </div>\n              </>\n            )}\n\n            {state === 'NOT_SUPPORTED' && (\n              <>\n                <h1 className=\"maintenance-title text-danger\">\n                  {translate('maintenance.migration_not_supported')}\n                </h1>\n                <p>{translate('maintenance.migration_not_supported.text')}</p>\n              </>\n            )}\n\n            {state === 'MIGRATION_RUNNING' && (\n              <>\n                <h1 className=\"maintenance-title\">{translate('maintenance.database_migration')}</h1>\n                {this.state.message && (\n                  <p className=\"maintenance-text text-center\">{this.state.message}</p>\n                )}\n                {this.state.startedAt && (\n                  <p className=\"maintenance-text text-center\">\n                    {translate('background_tasks.table.started')}{' '}\n                    <DateFromNow date={this.state.startedAt} />\n                    <br />\n                    <small className=\"text-muted\">\n                      <TimeFormatter date={this.state.startedAt} long={true} />\n                    </small>\n                  </p>\n                )}\n                <p className=\"maintenance-spinner\">\n                  <i className=\"spinner\" />\n                </p>\n              </>\n            )}\n\n            {state === 'MIGRATION_SUCCEEDED' && (\n              <>\n                <h1 className=\"maintenance-title text-success\">\n                  {translate('maintenance.database_is_up_to_date')}\n                </h1>\n                <p className=\"maintenance-text text-center\">\n                  <a href={getBaseUrl() + '/'}>{translate('layout.home')}</a>\n                </p>\n              </>\n            )}\n\n            {state === 'MIGRATION_FAILED' && (\n              <>\n                <h1 className=\"maintenance-title text-danger\">\n                  {translate('maintenance.upgrade_failed')}\n                </h1>\n                <p className=\"maintenance-text\">{translate('maintenance.upgrade_failed.text')}</p>\n              </>\n            )}\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n","\nvar content = require(\"!!../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../node_modules/postcss-loader/src/index.js??postcss!./styles.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../node_modules/postcss-loader/src/index.js??postcss!./styles.css\", function() {\n\t\tvar newContent = require(\"!!../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../node_modules/postcss-loader/src/index.js??postcss!./styles.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../../node_modules/css-loader/dist/runtime/api.js\")(false);\n// Module\nexports.push([module.id, \".maintenance-title{margin-bottom:40px;line-height:1.5;font-size:24px;font-weight:300;text-align:center}.maintenance-text{margin-bottom:16px;line-height:1.5;font-size:16px;font-weight:300}.maintenance-spinner{margin-top:40px;text-align:center}\", \"\"]);\n\n"],"sourceRoot":""}