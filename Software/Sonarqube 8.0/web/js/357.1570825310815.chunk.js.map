{"version":3,"sources":["webpack:///./node_modules/sonar-ui-common/components/icons/PlusIcon.js","webpack:///./src/main/js/apps/portfolio/components/CreateFormShim.tsx","webpack:///./src/main/js/app/components/nav/global/GlobalNavPlus.tsx","webpack:///./src/main/js/helpers/extensions.ts","webpack:///./src/main/js/api/nav.ts"],"names":["Object","defineProperty","exports","value","React","__webpack_require__","Icon_1","default","_a","className","_b","fill","size","createElement","d","style","_super","CreateFormShim","__extends","prototype","render","CreateForm","window","SonarGovernance","index_js_exposed","__assign","this","props","GlobalNavPlus_GlobalNavPlus","GlobalNavPlus","_this","apply","arguments","mounted","state","createPortfolio","governanceReady","handleNewProjectClick","event","preventDefault","openProjectOnboarding","openCreatePortfolioForm","setState","closeCreatePortfolioForm","handleNewPortfolioClick","currentTarget","blur","handleCreatePortfolio","key","qualifier","nav","component","then","data","configuration","extensions","find","item","router","push","urls","GlobalNavPlus_extends","componentDidMount","appState","qualifiers","includes","componentWillUnmount","renderCreateProject","canCreateProject","href","onClick","system","l10n","renderCreateOrganization","canCreateOrg","es","to","renderCreatePortfolio","showGovernanceEntry","defaultQualifier","currentUser","canCreateApplication","users","canCreatePortfolio","Dropdown_default","a","overlay","tagName","title","PlusIcon_default","components_CreateFormShim","onClose","onCreate","__webpack_exports__","librariesExposed","installScript","url","target","Promise","resolve","scriptTag","document","src","sonar_ui_common_helpers_urls__WEBPACK_IMPORTED_MODULE_0__","onload","getElementsByTagName","appendChild","getExtensionStart","fromCache","_extensionsHandler__WEBPACK_IMPORTED_MODULE_1__","all","e","bind","exposeLibraries","sent","start","reject","getComponentNavigation","getMarketplaceNavigation","getSettingsNavigation","sonar_ui_common_helpers_request__WEBPACK_IMPORTED_MODULE_0__","_app_utils_throwGlobalError__WEBPACK_IMPORTED_MODULE_1__","catch"],"mappings":"6FACAA,OAAAC,eAAAC,EAAA,cAA8CC,OAAA,IAC9C,IAAAC,EAAYC,EAAQ,IACpBC,EAAaD,EAAQ,KAMrBH,EAAAK,QALA,SAAAC,GACA,IAAAC,EAAAD,EAAAC,UAAAC,EAAAF,EAAAG,YAAA,IAAAD,EAAA,eAAAA,EAAAE,EAAAJ,EAAAI,KACA,OAAAR,EAAAS,cAAAP,EAAAC,QAAA,CAAiDE,YAAAG,QACjDR,EAAAS,cAAA,QAAqCC,EAAA,4DAAAC,MAAA,CAAyEJ,woBCoB9G,SAAAK,GAAA,SAAAC,mDAKA,OAL4CC,EAAAD,EAAAD,GAC1CC,EAAAE,UAAAC,OAAA,WACU,IAAAC,EAAAC,OAAAC,gBAAAF,WACR,OAAOG,EAAA,cAACH,EAAUI,EAAA,GAAKC,KAAKC,SAEhCV,EALA,CAA4CO,EAAA,0aCgB5CI,EAAA,SAAAZ,GAAA,SAAAa,IAAA,IAAAC,EAAA,OAAAd,KAAAe,MAAAL,KAAAM,YAAAN,YACEI,EAAAG,SAAU,EACVH,EAAAI,MAAe,CAAEC,iBAAiB,EAAOC,iBAAiB,GAoB1DN,EAAAO,sBAAwB,SAACC,GACvBA,EAAMC,iBACNT,EAAKH,MAAMa,yBAGbV,EAAAW,wBAA0B,WACxBX,EAAKY,SAAS,CAAEP,iBAAiB,KAGnCL,EAAAa,yBAA2B,WACzBb,EAAKY,SAAS,CAAEP,iBAAiB,KAGnCL,EAAAc,wBAA0B,SAACN,GACzBA,EAAMC,iBACND,EAAMO,cAAcC,OACpBhB,EAAKW,2BAGPX,EAAAiB,sBAAwB,SAACvC,OAAEwC,EAAAxC,EAAAwC,IAAKC,EAAAzC,EAAAyC,UAC9B,OAAOjD,OAAAkD,EAAA,EAAAlD,CAAuB,CAAEmD,UAAWH,IAAOI,KAAK,SAAAC,GAEnDA,EAAKC,eACLD,EAAKC,cAAcC,YACnBF,EAAKC,cAAcC,WAAWC,KAC5B,SAACC,GAAwC,6BAAAA,EAAKT,MAGhDlB,EAAKH,MAAM+B,OAAOC,KAAK3D,OAAA4D,EAAA,EAAA5D,CAAqBgD,EAAKC,IAEjDnB,EAAKH,MAAM+B,OAAOC,KAAK3D,OAAA4D,EAAA,EAAA5D,CAAgBgD,IAEzClB,EAAKa,gCAuGX,OA7JmCkB,EAAAhC,EAAAb,GAIjCa,EAAAV,UAAA2C,kBAAA,eAAAhC,EAAAJ,KACEA,KAAKO,SAAU,EACXP,KAAKC,MAAMoC,SAASC,WAAWC,SAAS,OAC1CjE,OAAAuD,EAAA,EAAAvD,CAAkB,sBAAsBoD,KACtC,WACMtB,EAAKG,SACPH,EAAKY,SAAS,CAAEN,iBAAiB,KAGrC,eAKNP,EAAAV,UAAA+C,qBAAA,WACExC,KAAKO,SAAU,GAuCjBJ,EAAAV,UAAAgD,oBAAA,SAAoBC,GAClB,OAAKA,EAIH5C,EAAA,wBACEA,EAAA,mBAAGf,UAAU,iBAAiB4D,KAAK,IAAIC,QAAS5C,KAAKW,uBAClDrC,OAAAuE,EAAA,aAAAvE,GACGA,OAAAwE,EAAA,UAAAxE,CAAU,oCACVA,OAAAwE,EAAA,UAAAxE,CAAU,+BAPX,MAaX6B,EAAAV,UAAAsD,yBAAA,SAAyBC,GACvB,OAAKA,EAKHlD,EAAA,wBACEA,EAAA,cAACmD,EAAA,KAAI,CAAClE,UAAU,sBAAsBmE,GAAG,wBACtC5E,OAAAwE,EAAA,UAAAxE,CAAU,wCANR,MAYX6B,EAAAV,UAAA0D,sBAAA,SAAsBC,EAA8BC,GAElD,OAD4BrD,KAAKC,MAAMoC,SAASC,WAAWC,SAAS,OACvCa,EAK3BtD,EAAA,wBACEA,EAAA,mBAAGf,UAAU,mBAAmB4D,KAAK,IAAIC,QAAS5C,KAAKkB,yBACpDmC,EACG/E,OAAAwE,EAAA,UAAAxE,CAAU,wBAAyB+E,GACnC/E,OAAAwE,EAAA,UAAAxE,CAAU,iDARX,MAcX6B,EAAAV,UAAAC,OAAA,WACU,IAUJ2D,EAVIC,EAAAtD,KAAAC,MAAAqD,YACFC,EAAuBjF,OAAAkF,EAAA,EAAAlF,CAAoBgF,EAAa,sBACxDN,EAAe1E,OAAAuE,EAAA,aAAAvE,GACfmF,EAAqBnF,OAAAkF,EAAA,EAAAlF,CAAoBgF,EAAa,oBACtDZ,EAAmBpE,OAAAuE,EAAA,aAAAvE,IAAkBA,OAAAkF,EAAA,EAAAlF,CAAoBgF,EAAa,gBAE5E,OAAKZ,GAAqBa,GAAyBE,GAAuBT,GAKrEO,EAEOE,IACVJ,EAAmB,OAFnBA,EAAmB,KAMnBvD,EAAA,cAAAA,EAAA,cACEA,EAAA,cAAC4D,EAAAC,EAAQ,CACPC,QACE9D,EAAA,oBAAIf,UAAU,QACXiB,KAAKyC,oBAAoBC,GACzB1C,KAAK+C,yBAAyBC,GAC9BhD,KAAKmD,sBACJI,GAAwBE,EACxBJ,IAINQ,QAAQ,MACR/D,EAAA,mBACEf,UAAU,0BACV4D,KAAK,IACLmB,MACExF,OAAAuE,EAAA,aAAAvE,GACIA,OAAAwE,EAAA,UAAAxE,CAAU,iDACVA,OAAAwE,EAAA,UAAAxE,CAAU,2DAEhBwB,EAAA,cAACiE,EAAAJ,EAAQ,QAGZ3D,KAAKQ,MAAME,iBAAmBV,KAAKQ,MAAMC,iBACxCX,EAAA,cAACkE,EAAc,CACbX,iBAAkBA,EAClBY,QAASjE,KAAKiB,yBACdiD,SAAUlE,KAAKqB,0BAvCd,MA6CblB,EA7JA,CAAmCL,EAAA,eA+JpBqE,EAAA,QAAA7F,OAAA2E,EAAA,YAAW/C,s6CCpLtBkE,GAAmB,EAEjB,SAAUC,EAAcC,EAAaC,GACzC,YADyC,IAAAA,MAAA,QAClC,IAAIC,QAAQ,SAAAC,GACjB,IAAMC,EAAYC,SAASxF,cAAc,UACzCuF,EAAUE,IAAM,GAAGtG,OAAAuG,EAAA,WAAAvG,GAAegG,EAClCI,EAAUI,OAASL,EACnBE,SAASI,qBAAqBR,GAAQ,GAAGS,YAAYN,KAInD,SAAgBO,EAAkB3D,mGAEtC,OADM4D,EAAY5G,OAAA6G,EAAA,EAAA7G,CAAsBgD,IAEtC,GAAOkD,QAAQC,QAAQS,IAGpBd,EAAD,MAEuB,GAAMI,QAAAY,IAAA,CAAAzG,EAAA0G,EAAA,GAAA1G,EAAA0G,EAAA,GAAA1G,EAAA0G,EAAA,GAAA1G,EAAA0G,EAAA,GAAA1G,EAAA0G,EAAA,OAAA3D,KAAA/C,EAAA2G,KAAA,oBAAzBC,EAAmBzG,EAAA0G,OAA8D3G,WAEvFuF,GAAmB,mBAGrB,SAAMC,EAAc,WAAW/C,EAAG,eAGlC,OAHAxC,EAAA0G,QAEMC,EAAQnH,OAAA6G,EAAA,EAAA7G,CAAsBgD,IAElC,GAAOmE,GAET,GAAOjB,QAAQkB,kDCpDjB/G,EAAAS,EAAA+E,EAAA,sBAAAwB,IAAAhH,EAAAS,EAAA+E,EAAA,sBAAAyB,IAAAjH,EAAAS,EAAA+E,EAAA,sBAAA0B,IAAA,IAAAC,EAAAnH,EAAA,IAAAoH,EAAApH,EAAA,KA4BM,SAAUgH,EACdhE,GAEA,OAAOrD,OAAAwH,EAAA,QAAAxH,CAAQ,4BAA6BqD,GAAMqE,MAAMD,EAAA,GAGpD,SAAUH,IACd,OAAOtH,OAAAwH,EAAA,QAAAxH,CAAQ,+BAA+B0H,MAAMD,EAAA,GAGhD,SAAUF,IACd,OAAOvH,OAAAwH,EAAA,QAAAxH,CAAQ,4BAA4B0H,MAAMD,EAAA","file":"js/357.1570825310815.chunk.js","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar React = require(\"react\");\nvar Icon_1 = require(\"./Icon\");\nfunction PlusIcon(_a) {\n    var className = _a.className, _b = _a.fill, fill = _b === void 0 ? 'currentColor' : _b, size = _a.size;\n    return (React.createElement(Icon_1.default, { className: className, size: size },\n        React.createElement(\"path\", { d: \"M1,7L7,7L7,1L9,1L9,7L15,7L15,9L9,9L9,15L7,15L7,9L1,9L1,7Z\", style: { fill: fill } })));\n}\nexports.default = PlusIcon;\n//# sourceMappingURL=PlusIcon.js.map","/*\n * SonarQube\n * Copyright (C) 2009-2019 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\n\ninterface Props {\n  defaultQualifier?: string;\n  onClose: () => void;\n  onCreate: (portfolio: { key: string; qualifier: string }) => void;\n}\n\nexport default class CreateFormShim extends React.Component<Props> {\n  render() {\n    const { CreateForm } = (window as any).SonarGovernance;\n    return <CreateForm {...this.props} />;\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2019 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { Link, withRouter, WithRouterProps } from 'react-router';\nimport Dropdown from 'sonar-ui-common/components/controls/Dropdown';\nimport PlusIcon from 'sonar-ui-common/components/icons/PlusIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getComponentNavigation } from '../../../../api/nav';\nimport CreateFormShim from '../../../../apps/portfolio/components/CreateFormShim';\nimport { getExtensionStart } from '../../../../helpers/extensions';\nimport { isSonarCloud } from '../../../../helpers/system';\nimport { getPortfolioAdminUrl, getPortfolioUrl } from '../../../../helpers/urls';\nimport { hasGlobalPermission } from '../../../../helpers/users';\nimport { OnboardingContextShape } from '../../OnboardingContext';\n\ninterface Props {\n  appState: Pick<T.AppState, 'qualifiers'>;\n  currentUser: T.LoggedInUser;\n  openProjectOnboarding: OnboardingContextShape;\n}\n\ninterface State {\n  createPortfolio: boolean;\n  governanceReady: boolean;\n}\n\nexport class GlobalNavPlus extends React.PureComponent<Props & WithRouterProps, State> {\n  mounted = false;\n  state: State = { createPortfolio: false, governanceReady: false };\n\n  componentDidMount() {\n    this.mounted = true;\n    if (this.props.appState.qualifiers.includes('VW')) {\n      getExtensionStart('governance/console').then(\n        () => {\n          if (this.mounted) {\n            this.setState({ governanceReady: true });\n          }\n        },\n        () => {}\n      );\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  handleNewProjectClick = (event: React.MouseEvent<HTMLAnchorElement>) => {\n    event.preventDefault();\n    this.props.openProjectOnboarding();\n  };\n\n  openCreatePortfolioForm = () => {\n    this.setState({ createPortfolio: true });\n  };\n\n  closeCreatePortfolioForm = () => {\n    this.setState({ createPortfolio: false });\n  };\n\n  handleNewPortfolioClick = (event: React.MouseEvent<HTMLAnchorElement>) => {\n    event.preventDefault();\n    event.currentTarget.blur();\n    this.openCreatePortfolioForm();\n  };\n\n  handleCreatePortfolio = ({ key, qualifier }: { key: string; qualifier: string }) => {\n    return getComponentNavigation({ component: key }).then(data => {\n      if (\n        data.configuration &&\n        data.configuration.extensions &&\n        data.configuration.extensions.find(\n          (item: { key: string; name: string }) => item.key === 'governance/console'\n        )\n      ) {\n        this.props.router.push(getPortfolioAdminUrl(key, qualifier));\n      } else {\n        this.props.router.push(getPortfolioUrl(key));\n      }\n      this.closeCreatePortfolioForm();\n    });\n  };\n\n  renderCreateProject(canCreateProject: boolean) {\n    if (!canCreateProject) {\n      return null;\n    }\n    return (\n      <li>\n        <a className=\"js-new-project\" href=\"#\" onClick={this.handleNewProjectClick}>\n          {isSonarCloud()\n            ? translate('provisioning.analyze_new_project')\n            : translate('my_account.create_new.TRK')}\n        </a>\n      </li>\n    );\n  }\n\n  renderCreateOrganization(canCreateOrg: boolean) {\n    if (!canCreateOrg) {\n      return null;\n    }\n\n    return (\n      <li>\n        <Link className=\"js-new-organization\" to=\"/create-organization\">\n          {translate('my_account.create_new_organization')}\n        </Link>\n      </li>\n    );\n  }\n\n  renderCreatePortfolio(showGovernanceEntry: boolean, defaultQualifier?: string) {\n    const governanceInstalled = this.props.appState.qualifiers.includes('VW');\n    if (!governanceInstalled || !showGovernanceEntry) {\n      return null;\n    }\n\n    return (\n      <li>\n        <a className=\"js-new-portfolio\" href=\"#\" onClick={this.handleNewPortfolioClick}>\n          {defaultQualifier\n            ? translate('my_account.create_new', defaultQualifier)\n            : translate('my_account.create_new_portfolio_application')}\n        </a>\n      </li>\n    );\n  }\n\n  render() {\n    const { currentUser } = this.props;\n    const canCreateApplication = hasGlobalPermission(currentUser, 'applicationcreator');\n    const canCreateOrg = isSonarCloud();\n    const canCreatePortfolio = hasGlobalPermission(currentUser, 'portfoliocreator');\n    const canCreateProject = isSonarCloud() || hasGlobalPermission(currentUser, 'provisioning');\n\n    if (!canCreateProject && !canCreateApplication && !canCreatePortfolio && !canCreateOrg) {\n      return null;\n    }\n\n    let defaultQualifier: string | undefined;\n    if (!canCreateApplication) {\n      defaultQualifier = 'VW';\n    } else if (!canCreatePortfolio) {\n      defaultQualifier = 'APP';\n    }\n\n    return (\n      <>\n        <Dropdown\n          overlay={\n            <ul className=\"menu\">\n              {this.renderCreateProject(canCreateProject)}\n              {this.renderCreateOrganization(canCreateOrg)}\n              {this.renderCreatePortfolio(\n                canCreateApplication || canCreatePortfolio,\n                defaultQualifier\n              )}\n            </ul>\n          }\n          tagName=\"li\">\n          <a\n            className=\"navbar-icon navbar-plus\"\n            href=\"#\"\n            title={\n              isSonarCloud()\n                ? translate('my_account.create_new_project_or_organization')\n                : translate('my_account.create_new_project_portfolio_or_application')\n            }>\n            <PlusIcon />\n          </a>\n        </Dropdown>\n        {this.state.governanceReady && this.state.createPortfolio && (\n          <CreateFormShim\n            defaultQualifier={defaultQualifier}\n            onClose={this.closeCreatePortfolioForm}\n            onCreate={this.handleCreatePortfolio}\n          />\n        )}\n      </>\n    );\n  }\n}\n\nexport default withRouter(GlobalNavPlus);\n","/*\n * SonarQube\n * Copyright (C) 2009-2019 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { getBaseUrl } from 'sonar-ui-common/helpers/urls';\nimport { getExtensionFromCache } from './extensionsHandler';\n\nlet librariesExposed = false;\n\nexport function installScript(url: string, target: 'body' | 'head' = 'body'): Promise<any> {\n  return new Promise(resolve => {\n    const scriptTag = document.createElement('script');\n    scriptTag.src = `${getBaseUrl()}${url}`;\n    scriptTag.onload = resolve;\n    document.getElementsByTagName(target)[0].appendChild(scriptTag);\n  });\n}\n\nexport async function getExtensionStart(key: string) {\n  const fromCache = getExtensionFromCache(key);\n  if (fromCache) {\n    return Promise.resolve(fromCache);\n  }\n\n  if (!librariesExposed) {\n    // Async import allows to reduce initial vendor bundle size\n    const exposeLibraries = (await import('../app/components/extensions/exposeLibraries')).default;\n    exposeLibraries();\n    librariesExposed = true;\n  }\n\n  await installScript(`/static/${key}.js`);\n\n  const start = getExtensionFromCache(key);\n  if (start) {\n    return start;\n  }\n  return Promise.reject();\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2019 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { getJSON } from 'sonar-ui-common/helpers/request';\nimport throwGlobalError from '../app/utils/throwGlobalError';\n\nexport function getGlobalNavigation(): Promise<T.AppState> {\n  return getJSON('/api/navigation/global');\n}\n\ntype NavComponent = T.Omit<T.Component, 'alm' | 'qualifier' | 'leakPeriodDate' | 'path' | 'tags'>;\n\nexport function getComponentNavigation(\n  data: { component: string } & T.BranchParameters\n): Promise<NavComponent> {\n  return getJSON('/api/navigation/component', data).catch(throwGlobalError);\n}\n\nexport function getMarketplaceNavigation(): Promise<{ serverId: string; ncloc: number }> {\n  return getJSON('/api/navigation/marketplace').catch(throwGlobalError);\n}\n\nexport function getSettingsNavigation(): Promise<any> {\n  return getJSON('/api/navigation/settings').catch(throwGlobalError);\n}\n"],"sourceRoot":""}